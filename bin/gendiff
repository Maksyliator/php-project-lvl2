#!/usr/bin/env php
<?php

require_once __DIR__ . '/../vendor/autoload.php';

use function difference\calculator\genDiff;
use Symfony\Component\Yaml\Yaml;

$doc = <<<DOC
Generate diff

Usage:
  gendiff (-h|--help)
  gendiff (-v|--version)
  gendiff [--format <fmt>] <firstFile> <secondFile>

Options:
  -h --help             Show this screen.
  -v --version          Show version.
  --format <fmt>        Report format [default: stylish]

DOC;

$args = Docopt::handle($doc, ['help' => true, 'version' => 'Generate diff 1.0']);

$pathToFirstFile = $args['<firstFile>'];
$pathToSecondFile = $args['<secondFile>'];
$firstFileContent = file_get_contents(__DIR__ . '/../' . $pathToFirstFile, true);
$secondFileContent = file_get_contents(__DIR__ . '/../' . $pathToSecondFile, true);
$extensionFirstFile = pathinfo($pathToFirstFile, PATHINFO_EXTENSION);
$extensionSecondFile = pathinfo($pathToSecondFile, PATHINFO_EXTENSION);

function transformation($fileContent, $extension)
{
    switch ($extension) {
        case 'json':
            return json_decode($fileContent);
        case 'yaml' || 'yml':
            return Yaml::parse($fileContent, Yaml::PARSE_OBJECT_FOR_MAP);
    }
}

$dataFirstFile = transformation($firstFileContent, $extensionFirstFile);
$dataSecondFile = transformation($secondFileContent, $extensionSecondFile);

print_r(genDiff($dataFirstFile, $dataSecondFile));
