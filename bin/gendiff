#!/usr/bin/env php
<?php

require_once __DIR__ . '/../vendor/autoload.php';

use function difference\calculator\genDiff;
use Symfony\Component\Yaml\Yaml;

$doc = <<<DOC
Generate diff

Usage:
  gendiff (-h|--help)
  gendiff (-v|--version)
  gendiff [--format <fmt>] <firstFile> <secondFile>

Options:
  -h --help             Show this screen.
  -v --version          Show version.
  --format <fmt>        Report format [default: stylish]

DOC;

$args = Docopt::handle($doc, ['help' => true, 'version' => 'Generate diff 1.0']);

$file1 = $args['<firstFile>'];
$file2 = $args['<secondFile>'];
$extensionFirstFile = substr($file1, -4, 4);
$extensionSecondFile = substr($file2, -4, 4);
if ($extensionFirstFile === 'json') {
    $file1Contents = file_get_contents(__DIR__ . '/../' . $file1, true);
    $data1 = json_decode($file1Contents);
} else {
    $data1 = Yaml::parseFile(__DIR__ . '/../' . $file1, Yaml::PARSE_OBJECT_FOR_MAP);
}
if ($extensionSecondFile === 'json') {
    $file2Contents = file_get_contents(__DIR__ . '/../' . $file2, true);
    $data2 = json_decode($file2Contents);
} else {
    $data2 = Yaml::parseFile(__DIR__ . '/../' . $file2, Yaml::PARSE_OBJECT_FOR_MAP);
}

print_r(genDiff($data1, $data2));
